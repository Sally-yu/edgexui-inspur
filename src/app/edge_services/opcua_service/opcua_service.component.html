<div *ngIf="show; then thenBlock; else elseBlock"></div>
<ng-template #thenBlock>
  <div style="margin-bottom: 16px;">
    <button nz-button  class="tool-btn-green"  (click)="addNewOpcRow()">
      新增
    </button>
    <button nz-button (click)="reFresh()" [nzType]="'primary'">
      刷新
    </button>
  </div>
  <nz-table #basicTable [nzData]="dataSet">
    <thead>
    <tr>
      <th>服务器名称</th>
      <th>服务器IP</th>
      <th>服务器位置</th>
      <th>OPC类型</th>
      <th>采集频率</th>
      <th>状态</th>
      <th>操作</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let data of basicTable.data">
      <td>{{data.servername}}</td>
      <td>{{data.serveraddress}}</td>
      <td>{{data.serverlocation}}</td>
      <td>{{data.opctype}}</td>
      <td>{{data.interval}}</td>
      <td>
          <div *ngIf="data.opcstate=='false'" nz-button  nzShape="circle" [nzSize]="small" style="width: 25px;height: 25px; background-color: #bfbfbf"></div>
          <div *ngIf="data.opcstate=='true'" nz-button  nzLoading nzType="primary" nzShape="circle" [nzSize]="small" style="width: 25px;height: 25px; background-color: #095df8"></div>
      </td>
      
      <td>
          <a style="font-size: 15px;" (click)="editRow(data.serveraddress)">编辑</a>
          <nz-divider nzType="vertical"></nz-divider>
          <a *ngIf="!toBoolean(data.opcstate)"  [id]="data.servername" style="color:rgb(67, 34, 255);font-size: 15px;"  (click)="startOPCServer(data.servername,data.serveraddress)">启动</a>
          <a *ngIf="toBoolean(data.opcstate)" style="color:#F22;font-size: 15px;" (click)="stopOPCServer(data.serveraddress)">停止</a>
          <nz-divider nzType="vertical"></nz-divider>
          <a style="color:#F22;" nz-popconfirm nzTitle="确定删除?" (nzOnConfirm)="deleteRow(data.serveraddress)">删除</a>
      </td>
    </tr>
    </tbody>
  </nz-table>
</ng-template>
<ng-template #elseBlock>
  <div style="margin-bottom: 16px;">
    <button class="tool-btn-green" nz-button (click)="saveOpcconfig()">保存配置</button>
    <button nz-button (click)="goback()">返回上级</button>
</div>

  <nz-content>
    <div nz-col nzSpan="6">
        <div nz-row nzGutter="8">
            <nz-form-item >
                <nz-form-label>服务器名称</nz-form-label>
                <input nz-input   [(ngModel)]="opcconfiginfo.servername">
              </nz-form-item>
        </div>
        <div nz-row nzGutter="6">
            <nz-form-item >
                <nz-form-label>服务器IP</nz-form-label>
                <input nz-input   [(ngModel)]="opcconfiginfo.serveraddress">
              </nz-form-item>
        </div>
        <div nz-row nzGutter="8">
            <nz-form-item >
                <nz-form-label>服务器位置</nz-form-label>
                <input nz-input   [(ngModel)]="opcconfiginfo.serverlocation">
              </nz-form-item>
      </div>
        <div nz-row nzGutter="8">
            <nz-form-item >
                <nz-form-label>备注</nz-form-label>
                <input nz-input   [(ngModel)]="opcconfiginfo.description">
              </nz-form-item>
        </div>
    </div>
    <div nz-col nzSpan="6" [nzOffset]="1">
        <div nz-row nzGutter="8">
            <nz-form-item>
                <nz-form-label>OPC类型</nz-form-label>
                <nz-select style="width: 100%" nzShowSearch [(ngModel)]="opcconfiginfo.opctype">
                  <nz-option *ngFor="let type of opcTypes" [nzLabel]="type"
                             [nzValue]="type"></nz-option>
                </nz-select>
              </nz-form-item>
        </div>
        <div nz-row nzGutter="8">
            <nz-form-item>
                <nz-form-label>OPC地址</nz-form-label>
                <nz-input-group nzSearch [nzSuffix]="suffixIconButton">
                    <input type="text" nz-input [(ngModel)]="opcconfiginfo.opchost"/>
                </nz-input-group>
                  <ng-template #suffixIconButton>
                    <button nz-button nzType="primary" (click)="search()" style="width:90%;left: 40%;"><i nz-icon type="search"></i></button>
                  </ng-template>
              </nz-form-item>
        </div>
        <div nz-row nzGutter="8">
          <nz-form-item>
              <nz-form-label>OPC链接</nz-form-label>
              <nz-select style="width: 100%" nzShowSearch [(ngModel)]="opcconfiginfo.serverurl">
                <nz-option *ngFor="let srv of servernames" [nzLabel]="srv"
                           [nzValue]="srv"></nz-option>
              </nz-select>
            </nz-form-item>
      </div>
        <div nz-row nzGutter="8">
            <nz-form-item>
                <nz-form-label>采集频率</nz-form-label>
                <nz-select style="width: 100%" nzShowSearch [(ngModel)]="opcconfiginfo.interval">
                  <nz-option *ngFor="let f of collectFrq" [nzLabel]="f+'ms'" [nzValue]="f"></nz-option>
                </nz-select>
            </nz-form-item>
        </div>
    </div>
    <div nz-col nzSpan="6" [nzOffset]="1"> 
        <div nz-row nzGutter="8">
            <nz-form-item>
                <nz-form-label>存储策略</nz-form-label>
                <nz-select style="width: 100%" nzShowSearch nzAllowClear [(ngModel)]="opcconfiginfo.savestrategy" (ngModelChange)="strategyChange(opcconfiginfo.savestrategy)">
                  <nz-option nzLabel="单机版部署" nzValue="单机版部署"></nz-option>
                  <nz-option nzLabel="双服务冗余" nzValue="双服务冗余"></nz-option>
                  <nz-option nzLabel="集群版部署" nzValue="集群版部署"></nz-option>
                </nz-select>
              </nz-form-item>
        </div>
        <div nz-row nzGutter="8">
            <nz-form-item>
                <nz-form-label>主数据库</nz-form-label>
                <nz-select style="width: 100%" nzShowSearch nzAllowClear [(ngModel)]="opcconfiginfo.servergroup[0]">
                  <ng-container *ngFor="let influx of influxlist">
                    <nz-option [nzLabel]="influx.servername" [nzValue]="influx.servername" *ngIf="isNotSelected(influx.servername)"></nz-option>
                  </ng-container>
                </nz-select> 
              </nz-form-item>
        </div>
        <div nz-row nzGutter="8">
            <nz-form-item *ngIf="opcconfiginfo.savestrategy !='单机版部署'">
                <nz-form-label>从数据库1</nz-form-label>
                <nz-select style="width: 100%" nzShowSearch nzAllowClear [(ngModel)]="opcconfiginfo.servergroup[1]">
                  <ng-container *ngFor="let influx of influxlist">
                    <nz-option [nzLabel]="influx.servername" [nzValue]="influx.servername" *ngIf="isNotSelected(opcconfiginfo.servergroup[1],influx.servername)"></nz-option>
                  </ng-container>
                </nz-select>
              </nz-form-item>
        </div>
        <div nz-row nzGutter="8">
            <div *ngIf="opcconfiginfo.savestrategy =='集群版部署'">
                <div *ngFor="let i of opcconfiginfo.login">
                    <div nz-row nzGutter="8">
                     <nz-form-item>
                      <nz-form-label > {{i.name}}</nz-form-label>
                      <nz-select style="width: 100%" nzShowSearch nzAllowClear [(ngModel)]="opcconfiginfo.servergroup[i.id]">
                        <ng-container *ngFor="let influx of influxlist">
                          <nz-option [nzLabel]="influx.servername" [nzValue]="influx.servername" *ngIf="isNotSelected(opcconfiginfo.servergroup[i.id],influx.servername)"></nz-option>
                        </ng-container>
                      </nz-select>
                    </nz-form-item>
                 </div>
                </div>
                <button *ngIf="addstate" class="tool-btn-blue" nz-button (click)="addInput()">
                  <i class="icon-play-circle"></i>添加数据库
                </button>
                <button *ngIf="removestate" class="tool-btn-red" nz-button (click)="removeInput()">
                  <i class="icon-poweroff"></i>删除数据库
                </button>
              </div>
        </div>
    </div>
  </nz-content>
</ng-template>

